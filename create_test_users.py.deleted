#!/usr/bin/env python3
"""
åˆ›å»ºæµ‹è¯•ç”¨æˆ·ç”¨äºæœç´¢åŠŸèƒ½æµ‹è¯•
"""

import sys
from app import app
from app_blueprints.permissions import get_user_manager

def create_test_users():
    """åˆ›å»ºæµ‹è¯•ç”¨æˆ·"""
    print("ğŸ”§ åˆ›å»ºæµ‹è¯•ç”¨æˆ·...")
    
    try:
        um = get_user_manager()
        
        # æµ‹è¯•ç”¨æˆ·æ•°æ®
        test_users = [
            {
                'username': 'test_user_1',
                'email': 'test1@example.com',
                'password': 'TestPassword123!',
                'is_admin': False
            },
            {
                'username': 'test_user_2',
                'email': 'test2@example.com',
                'password': 'TestPassword123!',
                'is_admin': False
            },
            {
                'username': 'admin_test',
                'email': 'admin@example.com',
                'password': 'AdminPassword123!',
                'is_admin': True
            },
            {
                'username': 'john_doe',
                'email': 'john.doe@company.com',
                'password': 'JohnPassword123!',
                'is_admin': False
            },
            {
                'username': 'jane_smith',
                'email': 'jane.smith@company.com',
                'password': 'JanePassword123!',
                'is_admin': False
            }
        ]
        
        created_count = 0
        for user_data in test_users:
            success, message = um.create_user(
                user_data['username'],
                user_data['email'],
                user_data['password'],
                user_data['is_admin']
            )
            
            if success:
                print(f"âœ… åˆ›å»ºç”¨æˆ·: {user_data['username']} ({user_data['email']})")
                created_count += 1
            else:
                print(f"âš ï¸ ç”¨æˆ·åˆ›å»ºå¤±è´¥: {user_data['username']} - {message}")
        
        print(f"\nğŸ“Š åˆ›å»ºç»“æœ: {created_count}/{len(test_users)} ç”¨æˆ·åˆ›å»ºæˆåŠŸ")
        
        # æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
        all_users = um.get_all_users(page=1, per_page=20)
        print(f"\nğŸ‘¥ å½“å‰ç”¨æˆ·æ€»æ•°: {all_users['total']}")
        print("ç”¨æˆ·åˆ—è¡¨:")
        for user in all_users['users']:
            admin_status = "ç®¡ç†å‘˜" if user.get('is_admin') else "æ™®é€šç”¨æˆ·"
            print(f"  - {user.get('username')} ({user.get('email')}) - {admin_status}")
        
        return True
        
    except Exception as e:
        print(f"âŒ åˆ›å»ºæµ‹è¯•ç”¨æˆ·å¼‚å¸¸: {e}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == '__main__':
    success = create_test_users()
    sys.exit(0 if success else 1)
