#!/usr/bin/env python3
"""
åˆ›å»ºç®€å•æµ‹è¯•ç”¨æˆ·ï¼ˆç»•è¿‡å¯†ç éªŒè¯ï¼‰
"""

import sys
import sqlite3
from werkzeug.security import generate_password_hash
from datetime import datetime

def create_simple_users():
    """ç›´æ¥åœ¨æ•°æ®åº“ä¸­åˆ›å»ºæµ‹è¯•ç”¨æˆ·"""
    print("ğŸ”§ ç›´æ¥åˆ›å»ºæµ‹è¯•ç”¨æˆ·...")
    
    try:
        # è¿æ¥æ•°æ®åº“
        conn = sqlite3.connect('ros2_wiki.db')
        cursor = conn.cursor()
        
        # æµ‹è¯•ç”¨æˆ·æ•°æ®
        test_users = [
            ('test_user_1', 'test1@example.com', False),
            ('test_user_2', 'test2@example.com', False),
            ('admin_test', 'admin@example.com', True),
            ('john_doe', 'john.doe@company.com', False),
            ('jane_smith', 'jane.smith@company.com', False),
            ('alice_wang', 'alice.wang@tech.com', False),
            ('bob_chen', 'bob.chen@tech.com', True),
        ]
        
        created_count = 0
        for username, email, is_admin in test_users:
            try:
                # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨
                cursor.execute("SELECT id FROM users WHERE username = ? OR email = ?", (username, email))
                if cursor.fetchone():
                    print(f"âš ï¸ ç”¨æˆ·å·²å­˜åœ¨: {username}")
                    continue
                
                # åˆ›å»ºç”¨æˆ·
                password_hash = generate_password_hash('SimplePassword123!')
                cursor.execute("""
                    INSERT INTO users (username, email, password_hash, is_admin, created_at)
                    VALUES (?, ?, ?, ?, ?)
                """, (username, email, password_hash, is_admin, datetime.now()))
                
                print(f"âœ… åˆ›å»ºç”¨æˆ·: {username} ({email}) - {'ç®¡ç†å‘˜' if is_admin else 'æ™®é€šç”¨æˆ·'}")
                created_count += 1
                
            except Exception as e:
                print(f"âŒ åˆ›å»ºç”¨æˆ·å¤±è´¥: {username} - {e}")
        
        conn.commit()
        
        # æ˜¾ç¤ºæ‰€æœ‰ç”¨æˆ·
        cursor.execute("SELECT id, username, email, is_admin FROM users ORDER BY created_at")
        users = cursor.fetchall()
        
        print(f"\nğŸ“Š åˆ›å»ºç»“æœ: {created_count} ç”¨æˆ·åˆ›å»ºæˆåŠŸ")
        print(f"ğŸ‘¥ å½“å‰ç”¨æˆ·æ€»æ•°: {len(users)}")
        print("ç”¨æˆ·åˆ—è¡¨:")
        for user in users:
            admin_status = "ç®¡ç†å‘˜" if user[3] else "æ™®é€šç”¨æˆ·"
            print(f"  - {user[1]} ({user[2]}) - {admin_status}")
        
        conn.close()
        return True
        
    except Exception as e:
        print(f"âŒ åˆ›å»ºæµ‹è¯•ç”¨æˆ·å¼‚å¸¸: {e}")
        import traceback
        traceback.print_exc()
        return False

if __name__ == '__main__':
    success = create_simple_users()
    sys.exit(0 if success else 1)
