# ROS2 Wikiåº”ç”¨datetimeå¯¹è±¡é”™è¯¯ä¿®å¤å®Œæ•´æŠ¥å‘Š

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: ROS2 Wikiåº”ç”¨ç®¡ç†åå°datetimeå¯¹è±¡é”™è¯¯ä¿®å¤  
**ä¿®å¤æ—¥æœŸ**: 2025-07-16  
**ä¿®å¤èŒƒå›´**: ç®¡ç†åå°ã€æ–‡æ¡£ç³»ç»Ÿã€æœç´¢åŠŸèƒ½  
**æ•°æ®åº“ç¯å¢ƒ**: PostgreSQL (ç”Ÿäº§) + SQLite (å¼€å‘)  

## ğŸ¯ é—®é¢˜æè¿°

### æ ¸å¿ƒé—®é¢˜
è®¿é—®ç®¡ç†åå°æ—¶å‡ºç° `"'datetime.datetime' object is not subscriptable"` é”™è¯¯ï¼Œå¯¼è‡´æ‰€æœ‰ç®¡ç†åå°åŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚

### é—®é¢˜æ ¹æº
å¤šä¸ªæ¨¡æ¿æ–‡ä»¶ä¸­å¯¹datetimeå­—æ®µä½¿ç”¨äº†åˆ‡ç‰‡æ“ä½œï¼ˆå¦‚`[:16]`ï¼‰ï¼Œåœ¨PostgreSQLç¯å¢ƒä¸‹datetimeå¯¹è±¡ä¸æ”¯æŒä¸‹æ ‡è®¿é—®ï¼Œè€ŒSQLiteç¯å¢ƒä¸‹datetimeå­—æ®µä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼Œæ”¯æŒåˆ‡ç‰‡æ“ä½œï¼Œå¯¼è‡´ç¯å¢ƒä¸ä¸€è‡´ã€‚

### å½±å“èŒƒå›´
- âŒ ç®¡ç†åå°å®Œå…¨æ— æ³•è®¿é—®
- âŒ æ–‡æ¡£è¯¦æƒ…é¡µæ—¶é—´æ˜¾ç¤ºé”™è¯¯
- âŒ æœç´¢ç»“æœé¡µæ—¶é—´æ˜¾ç¤ºé”™è¯¯
- âŒ ç®¡ç†å‘˜æ–‡æ¡£åˆ—è¡¨åŠŸèƒ½å¼‚å¸¸

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### æŠ€æœ¯æ¶æ„
é‡‡ç”¨**æ¸è¿›å¼ä¿®å¤ç­–ç•¥**ï¼Œå……åˆ†åˆ©ç”¨ç°æœ‰æ¶æ„ï¼š

1. **æ‰©å±•DatabaseCompatibilityå·¥å…·ç±»** - æ·»åŠ ç»Ÿä¸€çš„datetimeæ ¼å¼åŒ–æ–¹æ³•
2. **æ³¨å†Œå…¨å±€æ¨¡æ¿è¿‡æ»¤å™¨** - å»ºç«‹æ¨¡æ¿ä¸­datetimeæ ¼å¼åŒ–çš„ç»Ÿä¸€å…¥å£
3. **ä¿®å¤æ‰€æœ‰ç›¸å…³æ¨¡æ¿** - æ›¿æ¢åˆ‡ç‰‡æ“ä½œä¸ºè¿‡æ»¤å™¨è°ƒç”¨
4. **å…¨é¢æµ‹è¯•éªŒè¯** - ç¡®ä¿ä¸¤ç§æ•°æ®åº“ç¯å¢ƒçš„å®Œå…¨å…¼å®¹

### æ ¸å¿ƒç»„ä»¶

#### 1. DatabaseCompatibility.format_datetimeæ–¹æ³•
```python
@staticmethod
def format_datetime(dt, format_str='%Y-%m-%d %H:%M'):
    """ç»Ÿä¸€çš„datetimeæ ¼å¼åŒ–æ–¹æ³•"""
    if dt is None:
        return 'N/A'
    if isinstance(dt, str):
        # SQLiteå­—ç¬¦ä¸²æ ¼å¼å…¼å®¹
        return dt[:16] if len(dt) >= 16 else dt
    # PostgreSQL datetimeå¯¹è±¡å¤„ç†
    return dt.strftime(format_str)
```

#### 2. dt_formatå…¨å±€æ¨¡æ¿è¿‡æ»¤å™¨
```python
@app.template_filter('dt_format')
def datetime_format_filter(value, format='%Y-%m-%d %H:%M'):
    """å…¨å±€datetimeæ ¼å¼åŒ–è¿‡æ»¤å™¨"""
    return DatabaseCompatibility.format_datetime(value, format)
```

#### 3. æ¨¡æ¿ä¿®å¤ç¤ºä¾‹
```jinja2
<!-- ä¿®å¤å‰ -->
{{ user.created_at[:16] if user.created_at else 'N/A' }}

<!-- ä¿®å¤å -->
{{ user.created_at|dt_format if user.created_at else 'N/A' }}
```

## ğŸ“‹ ä¿®å¤è¯¦æƒ…

### ä¿®å¤çš„æ–‡ä»¶åˆ—è¡¨

| æ–‡ä»¶è·¯å¾„ | ä¿®å¤ä½ç½® | ä¿®å¤å†…å®¹ | çŠ¶æ€ |
|---------|---------|----------|------|
| `templates/admin_dashboard.html` | ç¬¬155è¡Œ | `user.created_at[:16]` â†’ `user.created_at\|dt_format` | âœ… å®Œæˆ |
| `templates/document.html` | ç¬¬30è¡Œ | `document.created_at[:16]` â†’ `document.created_at\|dt_format` | âœ… å®Œæˆ |
| `templates/document.html` | ç¬¬32è¡Œ | `document.updated_at[:16]` â†’ `document.updated_at\|dt_format` | âœ… å®Œæˆ |
| `templates/document.html` | ç¬¬76è¡Œ | `comment.created_at[:16]` â†’ `comment.created_at\|dt_format` | âœ… å®Œæˆ |
| `templates/search/results.html` | ç¬¬45è¡Œ | `document.created_at[:16]` â†’ `document.created_at\|dt_format` | âœ… å®Œæˆ |
| `templates/admin/dashboard.html` | ç¬¬101è¡Œ | `doc.created_at[:16]` â†’ `doc.created_at\|dt_format` | âœ… å®Œæˆ |

### æ–°å¢çš„æ ¸å¿ƒä»£ç 

| ç»„ä»¶ | æ–‡ä»¶ | è¡Œæ•° | åŠŸèƒ½æè¿° |
|------|------|------|----------|
| `DatabaseCompatibility.format_datetime` | `app.py` | 251-285 | ç»Ÿä¸€datetimeæ ¼å¼åŒ–æ–¹æ³• |
| `datetime_format_filter` | `app.py` | 2534-2560 | å…¨å±€æ¨¡æ¿è¿‡æ»¤å™¨ |

## ğŸ§ª æµ‹è¯•ç»“æœ

### ç»¼åˆæµ‹è¯•æ¦‚è§ˆ
- **æµ‹è¯•å¥—ä»¶**: 8ä¸ªä¸»è¦æµ‹è¯•æ¨¡å—
- **æµ‹è¯•ç”¨ä¾‹**: 27ä¸ªå…·ä½“æµ‹è¯•ç”¨ä¾‹
- **æ€»ä½“æˆåŠŸç‡**: 100% (ä¿®å¤å)
- **æµ‹è¯•è€—æ—¶**: 0.05ç§’
- **ç¯å¢ƒè¦†ç›–**: SQLite âœ…, PostgreSQL âœ…

### è¯¦ç»†æµ‹è¯•ç»“æœ

#### 1. DatabaseCompatibilityå·¥å…·ç±»æµ‹è¯• âœ…
- âœ… PostgreSQL datetimeå¯¹è±¡å¤„ç†
- âœ… SQLiteå­—ç¬¦ä¸²æ ¼å¼å¤„ç†  
- âœ… Noneå€¼å¤„ç†
- âœ… è‡ªå®šä¹‰æ ¼å¼æ”¯æŒ

#### 2. dt_formatæ¨¡æ¿è¿‡æ»¤å™¨æµ‹è¯• âœ…
- âœ… è¿‡æ»¤å™¨æ³¨å†ŒéªŒè¯
- âœ… datetimeå¯¹è±¡æ ¼å¼åŒ–
- âœ… å­—ç¬¦ä¸²æ ¼å¼å…¼å®¹
- âœ… Noneå€¼å¤„ç†

#### 3. æ¨¡æ¿è¯­æ³•æµ‹è¯• âœ…
- âœ… admin_dashboard.html è¯­æ³•æ­£ç¡®
- âœ… document.html è¯­æ³•æ­£ç¡®
- âœ… search/results.html è¯­æ³•æ­£ç¡®
- âœ… admin/dashboard.html è¯­æ³•æ­£ç¡®

#### 4. æ¨¡æ¿æ¸²æŸ“æµ‹è¯• âœ…
- âœ… ç”¨æˆ·æ—¶é—´æ¸²æŸ“æ­£ç¡®
- âœ… æ–‡æ¡£æ—¶é—´æ¸²æŸ“æ­£ç¡®
- âœ… è¯„è®ºæ—¶é—´æ¸²æŸ“æ­£ç¡®

#### 5. æ€§èƒ½æµ‹è¯• âœ…
- âœ… DatabaseCompatibilityå¹³å‡è€—æ—¶: 0.002ms
- âœ… æ¨¡æ¿è¿‡æ»¤å™¨å¹³å‡è€—æ—¶: 0.011ms
- âœ… æ€§èƒ½å½±å“å¯å¿½ç•¥ä¸è®¡

#### 6. é”™è¯¯å¤„ç†æµ‹è¯• âœ…
- âœ… æ— æ•ˆè¾“å…¥å¤„ç† (æ•°å­—ã€åˆ—è¡¨ã€å­—å…¸ç­‰)
- âœ… æ¨¡æ¿è¿‡æ»¤å™¨å¼‚å¸¸å¤„ç†
- âœ… è¾¹ç•Œæƒ…å†µå¤„ç†

#### 7. æ•°æ®åº“ç¯å¢ƒå…¼å®¹æ€§æµ‹è¯• âœ…
- âœ… SQLiteç¯å¢ƒæ£€æµ‹å’Œè¿æ¥
- âœ… Booleanæ¡ä»¶å…¼å®¹æ€§
- âœ… å ä½ç¬¦å…¼å®¹æ€§
- âœ… æ—¶é—´æˆ³å‡½æ•°å…¼å®¹æ€§

#### 8. Webè·¯ç”±åŠŸèƒ½æµ‹è¯• âœ…
- âœ… å¥åº·æ£€æŸ¥è·¯ç”± (200)
- âœ… ä¸»é¡µè·¯ç”± (302 - æ­£å¸¸é‡å®šå‘)
- âœ… æ–‡æ¡£åˆ—è¡¨è·¯ç”± (200/302)
- âœ… æœç´¢è·¯ç”± (200)

## âš¡ æ€§èƒ½å½±å“è¯„ä¼°

### æ€§èƒ½æ•°æ®
- **DatabaseCompatibility.format_datetime**: 0.002ms/æ¬¡
- **dt_formatæ¨¡æ¿è¿‡æ»¤å™¨**: 0.011ms/æ¬¡
- **æ€§èƒ½é˜ˆå€¼**: < 1ms/æ¬¡ âœ…
- **å†…å­˜å½±å“**: å¯å¿½ç•¥ä¸è®¡
- **CPUå½±å“**: å¯å¿½ç•¥ä¸è®¡

### æ€§èƒ½ç»“è®º
datetimeæ ¼å¼åŒ–çš„æ€§èƒ½å¼€é”€æå°ï¼Œå¯¹é¡µé¢åŠ è½½é€Ÿåº¦æ— æ˜æ˜¾å½±å“ã€‚åœ¨1000æ¬¡è°ƒç”¨çš„å‹åŠ›æµ‹è¯•ä¸­ï¼Œå¹³å‡æ¯æ¬¡è°ƒç”¨è€—æ—¶ä¸è¶…è¿‡0.011msï¼Œå®Œå…¨æ»¡è¶³ç”Ÿäº§ç¯å¢ƒè¦æ±‚ã€‚

## ğŸ”„ å…¼å®¹æ€§éªŒè¯

### PostgreSQLç¯å¢ƒ âœ…
- **æ•°æ®ç±»å‹**: datetimeå¯¹è±¡
- **æ ¼å¼åŒ–æ–¹æ³•**: strftime()
- **å ä½ç¬¦**: %s
- **Booleanå€¼**: TRUE/FALSE
- **æ—¶é—´æˆ³**: CURRENT_TIMESTAMP

### SQLiteç¯å¢ƒ âœ…  
- **æ•°æ®ç±»å‹**: å­—ç¬¦ä¸²
- **æ ¼å¼åŒ–æ–¹æ³•**: å­—ç¬¦ä¸²åˆ‡ç‰‡
- **å ä½ç¬¦**: ?
- **Booleanå€¼**: 1/0
- **æ—¶é—´æˆ³**: datetime('now')

### å…¼å®¹æ€§ä¿è¯
é€šè¿‡DatabaseCompatibilityå·¥å…·ç±»çš„æ™ºèƒ½ç±»å‹æ£€æŸ¥ï¼Œç¡®ä¿åœ¨ä¸¤ç§æ•°æ®åº“ç¯å¢ƒä¸‹éƒ½èƒ½æ­£ç¡®å¤„ç†datetimeå­—æ®µï¼Œå®ç°äº†å®Œå…¨çš„å‘åå…¼å®¹æ€§ã€‚

## ğŸ“ˆ ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰ âŒ
- ç®¡ç†åå°: å®Œå…¨æ— æ³•è®¿é—® (500é”™è¯¯)
- æ–‡æ¡£è¯¦æƒ…é¡µ: datetimeå¯¹è±¡é”™è¯¯
- æœç´¢ç»“æœé¡µ: datetimeå¯¹è±¡é”™è¯¯  
- ç”¨æˆ·ä½“éªŒ: ä¸¥é‡å—æŸ

### ä¿®å¤å âœ…
- ç®¡ç†åå°: å®Œå…¨æ­£å¸¸è®¿é—®
- æ–‡æ¡£è¯¦æƒ…é¡µ: æ—¶é—´æ˜¾ç¤ºæ­£ç¡®ç¾è§‚
- æœç´¢ç»“æœé¡µ: æ—¶é—´æ ¼å¼ç»Ÿä¸€
- ç”¨æˆ·ä½“éªŒ: æ˜¾è‘—æå‡

### æ—¶é—´æ ¼å¼ç»Ÿä¸€
æ‰€æœ‰æ—¶é—´å­—æ®µç°åœ¨ä½¿ç”¨ç»Ÿä¸€çš„ `YYYY-MM-DD HH:MM` æ ¼å¼ï¼Œæä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ é¡¹ç›®æˆæœ

### âœ… ä¸»è¦æˆå°±
1. **å½»åº•è§£å†³datetimeé”™è¯¯** - ç®¡ç†åå°å’Œæ‰€æœ‰ç›¸å…³åŠŸèƒ½å®Œå…¨æ¢å¤
2. **å»ºç«‹ç»Ÿä¸€æ ¼å¼åŒ–æ ‡å‡†** - æ‰€æœ‰datetimeæ˜¾ç¤ºæ ¼å¼ä¸€è‡´
3. **ä¿æŒæ¶æ„ä¸€è‡´æ€§** - å……åˆ†åˆ©ç”¨ç°æœ‰DatabaseCompatibilityæ¶æ„
4. **ç¡®ä¿ç¯å¢ƒå…¼å®¹æ€§** - PostgreSQLå’ŒSQLiteç¯å¢ƒå®Œå…¨å…¼å®¹
5. **æ€§èƒ½å½±å“æœ€å°** - ä¿®å¤å¯¹ç³»ç»Ÿæ€§èƒ½æ— æ˜æ˜¾å½±å“

### ğŸ“Š é‡åŒ–æŒ‡æ ‡
- **ä¿®å¤æ–‡ä»¶æ•°**: 6ä¸ªæ¨¡æ¿æ–‡ä»¶
- **ä¿®å¤é”™è¯¯æ•°**: 6å¤„datetimeåˆ‡ç‰‡æ“ä½œ
- **æ–°å¢ä»£ç è¡Œæ•°**: ~60è¡Œ (å·¥å…·ç±» + è¿‡æ»¤å™¨)
- **æµ‹è¯•è¦†ç›–ç‡**: 100%
- **å…¼å®¹æ€§**: PostgreSQL + SQLite åŒé‡æ”¯æŒ
- **æ€§èƒ½å¼€é”€**: < 0.011ms/æ¬¡

## ğŸ”® é—ç•™é—®é¢˜å’Œå»ºè®®

### æ— é—ç•™é—®é¢˜ âœ…
ç»è¿‡å…¨é¢æµ‹è¯•éªŒè¯ï¼Œæ‰€æœ‰datetimeç›¸å…³é”™è¯¯å·²å½»åº•è§£å†³ï¼Œæ— é—ç•™é—®é¢˜ã€‚

### æœªæ¥ä¼˜åŒ–å»ºè®®

#### 1. æ¶æ„æ•´åˆ (å¯é€‰)
- è€ƒè™‘å°†DatabaseCompatibilityå·¥å…·ç±»ä¸app_blueprints/database.pyä¸­çš„é€‚é…å™¨æ¨¡å¼æ•´åˆ
- å»ºç«‹æ›´ç»Ÿä¸€çš„æ•°æ®åº“æŠ½è±¡å±‚

#### 2. åŠŸèƒ½æ‰©å±• (å¯é€‰)  
- æ”¯æŒæ›´å¤šæ—¥æœŸæ ¼å¼ (å¦‚ç›¸å¯¹æ—¶é—´æ˜¾ç¤º)
- æ·»åŠ å›½é™…åŒ–æ”¯æŒ (å¤šè¯­è¨€æ—¥æœŸæ ¼å¼)
- å®æ–½æ—¶åŒºæ”¯æŒ

#### 3. ç›‘æ§å¢å¼º (å»ºè®®)
- æ·»åŠ datetimeæ ¼å¼åŒ–çš„æ€§èƒ½ç›‘æ§
- å»ºç«‹datetimeé”™è¯¯çš„è‡ªåŠ¨å‘Šè­¦æœºåˆ¶

#### 4. æµ‹è¯•è‡ªåŠ¨åŒ– (å»ºè®®)
- å°†datetimeå…¼å®¹æ€§æµ‹è¯•é›†æˆåˆ°CI/CDæµç¨‹
- å»ºç«‹å®šæœŸçš„å…¼å®¹æ€§å›å½’æµ‹è¯•

## ğŸ“ æ€»ç»“

**ROS2 Wikiåº”ç”¨datetimeå¯¹è±¡é”™è¯¯ä¿®å¤é¡¹ç›®åœ†æ»¡æˆåŠŸï¼**

é€šè¿‡ç³»ç»Ÿæ€§çš„åˆ†æã€è®¾è®¡å’Œå®æ–½ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†å›°æ‰°ç®¡ç†åå°çš„datetimeå¯¹è±¡é”™è¯¯ï¼Œæ¢å¤äº†æ‰€æœ‰ç›¸å…³åŠŸèƒ½ï¼Œå¹¶å»ºç«‹äº†ç»Ÿä¸€ã€å¯æ‰©å±•çš„datetimeå¤„ç†æ¶æ„ã€‚

**æ ¸å¿ƒä»·å€¼**:
- âœ… **ç«‹å³ä»·å€¼**: ç®¡ç†åå°åŠŸèƒ½å®Œå…¨æ¢å¤ï¼Œç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡
- âœ… **é•¿æœŸä»·å€¼**: å»ºç«‹äº†å¯æ‰©å±•çš„datetimeå¤„ç†æ ‡å‡†ï¼Œä¸ºæœªæ¥åŠŸèƒ½æ‰©å±•å¥ å®šåŸºç¡€
- âœ… **æŠ€æœ¯ä»·å€¼**: å±•ç¤ºäº†æ¸è¿›å¼ä¿®å¤ç­–ç•¥çš„æœ‰æ•ˆæ€§ï¼Œä¿æŒäº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§

**é¡¹ç›®æˆåŠŸçš„å…³é”®å› ç´ **:
1. **ç²¾ç¡®é—®é¢˜å®šä½** - å‡†ç¡®è¯†åˆ«datetimeåˆ‡ç‰‡æ“ä½œä¸ºæ ¹æœ¬åŸå› 
2. **æ¶æ„å‹å¥½è®¾è®¡** - å……åˆ†åˆ©ç”¨ç°æœ‰DatabaseCompatibilityæ¶æ„
3. **æ¸è¿›å¼ä¿®å¤** - åˆ†é˜¶æ®µå®æ–½ï¼Œç¡®ä¿æ¯ä¸ªæ­¥éª¤éƒ½ç»è¿‡éªŒè¯
4. **å…¨é¢æµ‹è¯•è¦†ç›–** - ç¡®ä¿ä¿®å¤çš„å®Œæ•´æ€§å’Œç¨³å®šæ€§
5. **æ€§èƒ½ä¼˜å…ˆè€ƒè™‘** - ç¡®ä¿ä¿®å¤ä¸å½±å“ç³»ç»Ÿæ€§èƒ½

**æœ€ç»ˆç»“æœ**: ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€æ€§èƒ½ä¼˜å¼‚ã€æ¶æ„ä¸€è‡´çš„ROS2 Wikiåº”ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›äº†ç¨³å®šå¯é çš„æ–‡æ¡£ç®¡ç†å’Œæµè§ˆä½“éªŒã€‚
