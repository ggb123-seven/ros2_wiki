# ROS2 Wiki 用户管理操作指南

## 概述

ROS2 Wiki 系统提供了完整的用户管理和黑名单功能，允许管理员有效地管理用户账户、监控用户行为并维护社区秩序。

## 功能特性

### 🔧 核心功能
- **用户列表管理** - 查看、搜索、筛选所有注册用户
- **黑名单管理** - 拉黑/解除拉黑用户，阻止恶意用户登录
- **批量操作** - 支持批量拉黑、批量删除等操作
- **操作审计** - 完整的操作日志记录和审计功能
- **安全警报** - 自动检测异常操作模式

### 🛡️ 安全特性
- **权限控制** - 仅管理员可访问用户管理功能
- **操作日志** - 所有管理操作都有详细记录
- **登录拦截** - 黑名单用户无法登录系统
- **CSRF保护** - 防止跨站请求伪造攻击

## 快速开始

### 访问用户管理

1. 以管理员身份登录系统
2. 点击顶部导航栏的"管理后台"
3. 在管理后台主页点击"用户管理"按钮
4. 或直接访问：`/admin/users/`

### 基本操作

#### 查看用户列表
- 用户列表显示所有注册用户的基本信息
- 包括：ID、用户名、邮箱、权限、状态、最后登录时间等
- 支持分页浏览，每页可显示10/20/50个用户

#### 搜索和筛选
- **关键词搜索**：在搜索框中输入用户名或邮箱进行搜索
- **状态筛选**：
  - 全部用户
  - 正常用户
  - 黑名单用户
  - 管理员用户

## 黑名单管理

### 拉黑用户

1. 在用户列表中找到目标用户
2. 点击该用户行的"拉黑"按钮（⚠️图标）
3. 在弹出的确认对话框中：
   - 输入拉黑原因（必填）
   - 点击"确认拉黑"按钮
4. 系统将自动：
   - 更新用户状态为"已拉黑"
   - 记录拉黑时间和原因
   - 生成操作日志

### 解除拉黑

1. 找到已拉黑的用户（状态显示为"已拉黑"）
2. 点击"解除拉黑"按钮（🔓图标）
3. 确认操作
4. 用户状态恢复为正常

### 批量拉黑

1. 使用复选框选择多个用户
2. 点击"批量拉黑"按钮
3. 输入批量拉黑原因
4. 确认操作

### 黑名单用户列表

- 访问：`/admin/users/blacklisted`
- 专门显示所有被拉黑的用户
- 显示拉黑时间和原因
- 支持快速解除拉黑操作

## 操作日志和审计

### 查看操作日志

1. 访问：`/admin/users/audit/logs`
2. 查看所有用户管理操作的详细记录
3. 支持多维度筛选：
   - 按管理员筛选
   - 按目标用户筛选
   - 按操作类型筛选
   - 按时间范围筛选

### 管理员活动摘要

1. 访问：`/admin/users/audit/activity`
2. 查看管理员活动统计：
   - 操作类型统计
   - 最活跃管理员排行
   - 安全警报
   - 活动趋势分析

### 导出日志

1. 在审计日志页面设置筛选条件
2. 点击"导出CSV"按钮
3. 下载包含筛选结果的CSV文件

## 安全警报

系统会自动检测以下异常操作模式：

### 高风险警报
- **频繁拉黑操作**：管理员在短时间内执行大量拉黑操作
- **异常批量操作**：频繁使用批量操作功能

### 中风险警报
- **深夜操作**：在非工作时间（22:00-06:00）进行管理操作

### 警报处理
1. 查看警报详情
2. 分析操作合理性
3. 必要时联系相关管理员确认
4. 记录处理结果

## 最佳实践

### 用户管理
1. **定期审查**：定期检查用户列表，清理无效账户
2. **权限最小化**：仅授予必要的管理员权限
3. **操作记录**：重要操作前记录操作原因

### 黑名单管理
1. **明确原因**：拉黑用户时必须提供明确的原因
2. **及时处理**：发现违规行为及时处理
3. **定期复查**：定期复查黑名单，考虑是否解除

### 安全维护
1. **日志监控**：定期查看操作日志，发现异常
2. **权限审计**：定期审计管理员权限
3. **备份数据**：定期备份用户数据和日志

## 故障排除

### 常见问题

#### 无法拉黑用户
- **检查权限**：确认当前用户具有管理员权限
- **检查状态**：确认目标用户未被拉黑
- **检查网络**：确认网络连接正常

#### 黑名单用户仍能登录
- **清除缓存**：清除浏览器缓存和会话
- **检查数据库**：确认用户状态已正确更新
- **重启服务**：必要时重启应用服务

#### 操作日志缺失
- **检查权限**：确认操作时具有管理员权限
- **检查数据库**：确认user_logs表正常工作
- **检查代码**：确认日志记录代码正常执行

### 技术支持

如遇到技术问题，请：
1. 查看系统日志
2. 检查数据库状态
3. 联系系统管理员
4. 提供详细的错误信息和操作步骤

## 更新日志

### v1.0.0 (2024-01-XX)
- ✅ 基础用户管理功能
- ✅ 黑名单管理功能
- ✅ 操作日志和审计
- ✅ 安全警报系统
- ✅ 批量操作支持
- ✅ CSV导出功能

---

**注意**：本指南基于ROS2 Wiki v1.0.0版本编写，功能可能随版本更新而变化。
